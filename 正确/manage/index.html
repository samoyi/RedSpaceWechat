<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>管理</title>
</head>
<body>

<a href="CsMessage.html" ><h2>根据订单号发送客服消息</h2></a>
<a href="sendCardByOrderID.html" ><h2>根据订单号发送卡券</h2></a>
<h2>切换自动回复 <input id="switchAutoReply" type="button" value="读取中" /></h2> 


</body>
<script>



(function()
{
	var oSwitchAutoReply = document.querySelector("#switchAutoReply"),
	sUrl = "switchAutoReply.php";

	getAutoReplyByTimeState(); // 读取当前状态并写入按钮
	function getAutoReplyByTimeState()
	{
		var sUrl = "manageConfigration.js",
			fnSuccess = function( responseText )
			{
				var oManageConfigration = JSON.parse( responseText ),
				sAutoReplyByTimeState = oManageConfigration.autoReplyByTime;
				if( 'on' === sAutoReplyByTimeState )
				{
					oSwitchAutoReply.value = responseText = '下班时段自动回复已打开';
				}
				else
				{
					oSwitchAutoReply.value = responseText = '下班时段自动回复已关闭';
				}
			}
		AjaxGet(sUrl, fnSuccess);
	}


	oSwitchAutoReply.addEventListener("click", function() // 点击按钮
	{
		var sUrl = "switchAutoReply.php",
			fnSuccess = function( responseText )
			{
				oSwitchAutoReply.value = responseText;
			},
			fnFail = function()
			{
				alert( "切换失败" );
			};
		AjaxGet(sUrl, fnSuccess, fnFail);
	}, false);

})();




//fnSuccess可传参作为responseText的引用
function AjaxGet(sUrl, fnSuccess, fnFail)
{
	var xhr = new XMLHttpRequest();
	xhr.addEventListener('readystatechange', function()
	{
		if (xhr.readyState == 4)
		{
			if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304)
			{
			    fnSuccess(xhr.responseText);
			}
			else if(fnFail) 
			{

			    fnFail();
			}
		}
	}, false);
	xhr.open("get", sUrl, true);
	xhr.send(null);

}

</script>
</html>